# Docker Development Environment for {{PROJECT_NAME}}

This project includes a comprehensive Docker Compose setup optimized for Figma-exported React/Vite/TypeScript projects with heavy UI dependencies.

**Generated by:** Figma Docker Init v1.0.0  
**Template:** UI-Heavy ({{UI_LIBRARIES}})  
**Build Tool:** {{BUILD_TOOL}}  
**Output Directory:** {{BUILD_OUTPUT_DIR}}

## üìã Project Configuration

### Detected Configuration
- **Framework:** {{FRAMEWORK}}
- **Build Tool:** {{BUILD_TOOL}}
- **TypeScript:** {{HAS_TYPESCRIPT}}
- **UI Libraries:** {{UI_LIBRARIES}}
- **Dependencies:** {{DEPENDENCY_COUNT}} packages
- **Build Output:** {{BUILD_OUTPUT_DIR}}/

### Services Overview

#### Development Service (`app-dev`)
- **Base Image:** Node.js 18 Alpine
- **Port:** 3000
- **Features:** Hot reload, volume mounts, health checks
- **Memory:** 4GB (optimized for large UI dependency trees)
- **Command:** `npm run dev` with host binding

#### Production Service (`app-prod`)
- **Build:** Multi-stage Dockerfile with Nginx
- **Port:** 8080 (maps to internal port 80)
- **Features:** Optimized build, security headers, asset caching
- **Profile:** `production` (optional service)

#### Nginx Proxy (`nginx-dev`)
- **Purpose:** Reverse proxy for advanced scenarios
- **Port:** 80
- **Profile:** `proxy` (optional service)
- **Features:** WebSocket support for HMR, rate limiting

## üöÄ Quick Start Commands

### Development Mode
```bash
# Start development environment
docker compose up app-dev

# Start with logs
docker compose up app-dev --build

# Run in background
docker compose up -d app-dev

# Stop services
docker compose down
```

### Production Mode
```bash
# Build and start production service
docker compose --profile production up app-prod --build

# Test production build locally
docker compose --profile production up -d app-prod
```

### With Nginx Proxy
```bash
# Start development with nginx proxy
docker compose --profile proxy up app-dev nginx-dev

# Access via http://localhost (port 80)
```

## üìÅ Volume Strategy

### Named Volumes
- `node_modules`: Persistent storage for dependencies
- **Critical for UI-heavy projects:** Avoids reinstalling large dependency trees
- Improves performance across container restarts
- Prevents cross-platform compatibility issues

### Bind Mounts
- Source code (`.:/app`): Enables hot reload
- Nginx config (`./nginx.conf`): Custom proxy configuration

### Anonymous Volumes
- `/app/node_modules`: Prevents host node_modules interference

## üîß Environment Variables

### Development Variables
```bash
NODE_ENV=development
VITE_HOST=0.0.0.0
VITE_PORT=3000
CHOKIDAR_USEPOLLING=true
NODE_OPTIONS=--max-old-space-size=4096  # Increased for UI builds
```

### Custom Environment
Create a `.env` file (copy from `.env.example`) and modify as needed:
```bash
cp .env.example .env
# Edit .env with your settings
```

## üè• Health Checks

All services include comprehensive health checks:
- **Development:** Checks Vite dev server on port 3000
- **Production:** Checks Nginx health endpoint on port 80
- **Interval:** 30 seconds
- **Timeout:** 10 seconds
- **Retries:** 3 attempts
- **Start Period:** Extended for large UI builds

## üåê Networking

### Custom Network
- **Name:** `{{PROJECT_NAME}}-network`
- **Driver:** Bridge
- **Purpose:** Service isolation and communication

### Port Mapping
- **Development:** `localhost:3000` ‚Üí container:3000
- **Production:** `localhost:8080` ‚Üí container:80
- **Nginx:** `localhost:80` ‚Üí container:80

## üêõ Troubleshooting

### Common Issues in Figma Projects

1. **Build Memory Errors**
   ```bash
   # Increase Node.js memory limit
   NODE_OPTIONS=--max-old-space-size=8192
   
   # Or in docker-compose.yml
   environment:
     - NODE_OPTIONS=--max-old-space-size=8192
   ```

2. **Slow Dependency Installation**
   ```bash
   # Clear named volume and rebuild
   docker compose down -v
   docker volume rm {{PROJECT_NAME}}_node_modules
   docker compose up app-dev --build
   ```

3. **Vite Build Output Issues**
   ```bash
   # Verify build output directory matches Dockerfile
   # Check vite.config.* for outDir setting
   # Current setting: {{BUILD_OUTPUT_DIR}}/
   ```

4. **Port Already in Use**
   ```bash
   # Check what's using the port
   lsof -i :3000
   
   # Use different port
   docker compose up app-dev -p 3001:3000
   ```

5. **Hot Reload Not Working**
   - Ensure `CHOKIDAR_USEPOLLING=true` is set
   - Check volume mounts are correct
   - Restart container: `docker compose restart app-dev`

6. **Large Asset Loading Issues**
   ```bash
   # Increase client_max_body_size in nginx.conf
   client_max_body_size 100M;
   ```

### UI Library Specific Issues

1. **Radix UI Hydration Errors**
   - Ensure SSR is disabled in development
   - Check for client/server rendering mismatches

2. **Tailwind CSS Not Loading**
   - Verify tailwind.config.js includes all component paths
   - Check if PostCSS is properly configured

3. **Icon Loading Issues**
   - Ensure Lucide React icons are in dependencies
   - Check SVG import configurations

## üîß Development Workflow

### Typical Development Session
```bash
# 1. Start development environment
docker compose up -d app-dev

# 2. Check health status
docker compose ps

# 3. View logs
docker compose logs -f app-dev

# 4. Access application
open http://localhost:3000

# 5. Make code changes (hot reload active)

# 6. Stop when done
docker compose down
```

### Testing Production Build
```bash
# 1. Build production image
docker compose --profile production build app-prod

# 2. Start production service
docker compose --profile production up -d app-prod

# 3. Test production app
open http://localhost:8080

# 4. Clean up
docker compose --profile production down
```

## üöÄ Advanced Usage

### Custom Overrides
Create `docker-compose.override.yml` for local customizations:
```yaml
version: '3.8'
services:
  app-dev:
    environment:
      - NODE_OPTIONS=--max-old-space-size=8192  # More memory
    ports:
      - "3001:3000"  # Different port
```

### Performance Optimization
```bash
# Build with BuildKit for faster builds
DOCKER_BUILDKIT=1 docker compose build app-prod

# Use multi-stage target for development
docker compose build --target builder app-dev
```

### Debugging
```bash
# Execute commands in running container
docker compose exec app-dev sh

# Check container internals
docker compose exec app-dev npm list

# View container logs with timestamps
docker compose logs --tail 100 -t app-dev

# Monitor resource usage
docker stats {{PROJECT_NAME}}-dev
```

## üìä Build Process Notes

The production Dockerfile uses an optimized multi-stage build:

1. **Builder Stage:**
   - Uses Node.js 18 Alpine for smaller footprint
   - Installs ALL dependencies (including devDependencies)
   - **Critical:** Figma projects need devDependencies for build
   - Builds application to `{{BUILD_OUTPUT_DIR}}/`
   - Creates non-root user for security

2. **Production Stage:**
   - Uses Nginx Alpine for serving
   - Copies built files from builder stage
   - Includes security headers and optimizations
   - Configured for SPA routing
   - Serves on port 80 with health checks

### Security Features
- Non-root user in build stage
- Security headers (X-Frame-Options, X-XSS-Protection, etc.)
- Hidden nginx version
- Restricted file access
- Rate limiting for API endpoints

## üìà Performance Optimizations

### For Large UI Projects
- Named volumes for node_modules caching
- Multi-stage builds to reduce final image size
- Gzip compression for static assets
- Asset caching with proper headers
- Memory limits adjusted for UI builds

### Build Optimizations
- Layer caching for package.json changes
- .dockerignore excludes unnecessary files
- Parallel dependency installation
- Optimized nginx configuration

## üîç Monitoring

### Health Check Endpoints
- **Development:** `http://localhost:3000` (Vite dev server)
- **Production:** `http://localhost:8080/health` (Nginx health check)
- **Nginx Proxy:** `http://localhost/nginx-health`

### Logs
```bash
# View all service logs
docker compose logs

# Follow specific service
docker compose logs -f app-dev

# View with timestamps
docker compose logs -t app-prod
```

## üìö Additional Resources

- [Docker Compose Documentation](https://docs.docker.com/compose/)
- [Vite Docker Guide](https://vitejs.dev/guide/static-deploy.html)
- [Nginx Configuration Reference](https://nginx.org/en/docs/)
- [Figma Docker Init Repository](https://github.com/your-repo/figma-docker-init)

---

**Generated by Figma Docker Init** - Streamlined Docker setup for Figma-exported projects